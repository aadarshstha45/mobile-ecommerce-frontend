import{f as B,r as i,e as N,a1 as k,j as o,F as h,B as j,I as A,ap as M,T as c,i as G,ae as m,b as y,am as v}from"./index-DQ2lrmGm.js";import{a as J}from"./index-DN8y_mam.js";import{a as V}from"./TextInput-ChqmmbFd.js";import{u as H}from"./orderStore-CCDu8wPJ.js";import{S as Q,G as P}from"./chunk-ZPFGWTBB-y0nQshkI.js";import"./x-BEYZqOP6.js";import"./chunk-H46NUPBZ-BGFkfMlP.js";const oe=({stepProps:b})=>{const z=B(),[p,_]=i.useState([]),[x]=N("(max-width: 469px)"),[l,I]=i.useState(0),[a,C]=i.useState(0),[w,f]=i.useState(0),[S,u]=i.useState(0),[D,E]=i.useState(""),[q,R]=i.useState(""),{control:W,handleSubmit:F}=k({defaultValues:{total_amount:"",promo_code:""}}),g=J(),{setStepData:L}=H();i.useEffect(()=>{const e=sessionStorage.getItem("cartItems");if(e){const r=JSON.parse(e);_(r);let s=0;r.forEach(t=>{s+=t.totalPrice*t.quantity});let n=0;r.forEach(t=>{n+=t.discountedPrice>0?t.discountedPrice*t.quantity:t.totalPrice*t.quantity}),I(s),C(n),f(n)}},[z.pathname,sessionStorage.getItem("cartItems")]);const O=async e=>{try{const r=await g.mutateAsync({...e,total_amount:a>0?a:l});if(r.data.valid){E(e.promo_code);const s=r.data.type,n=parseFloat(r.data.rate),t=parseFloat(r.data.max_discount);if(s==="percentage"){const d=a>0?a*n/100:l*n/100;if(d>=t){u(t),f(a>0?a-t:l-t);return}else{u(d),f(a>0?a-d:l-d);return}}else{u(n),f(a>0?a-n:l-S);return}}else R(r.data.error),u(0)}catch(r){console.error("Error applying promo code:",r),u(0)}},T=()=>{const e=sessionStorage.getItem("cartItems");if(e&&e.length>0){const r=JSON.parse(e);L({order_items:r.map(s=>{var n,t,d;return{cart_id:s==null?void 0:s.id,product_id:(n=s==null?void 0:s.product)==null?void 0:n.id,quantity:s==null?void 0:s.quantity,discount:s.discountedPrice?s.totalPrice-s.discountedPrice:0,price:s.size?s.size.price:s.product.price,size_id:(t=s==null?void 0:s.size)==null?void 0:t.id,color_id:(d=s==null?void 0:s.color)==null?void 0:d.id,total:s.discountedPrice??s.totalPrice}}),promo_discount:S,total_amount:a??l,promo_code:D??null}),b.nextStep()}else v.error("No items in the cart")};return o.jsxs(Q,{columns:{base:1,md:2},gap:6,alignItems:"start",children:[o.jsx(P,{colSpan:1,children:o.jsx(h,{flexDir:"column",gap:4,children:p&&p.map(e=>o.jsx(j,{borderBottom:"1px solid #939292",py:6,children:o.jsxs(h,{gap:8,flexDir:x?"column":"row",align:x?"start":"center",children:[o.jsx(A,{src:e.product.image??M,alt:e.product.name,objectFit:e.product.image?"cover":"contain",objectPosition:"center",w:{base:"100px",md:"150px"},aspectRatio:1/1}),o.jsxs(h,{flexDir:"column",gap:3,minW:x?"100%":"50%",w:x?"100%":"50%",children:[o.jsx(c,{fontWeight:600,noOfLines:2,fontSize:"md",children:e.product.name}),e.size&&o.jsxs(c,{fontSize:"md",children:["Size: ",e.size.name]}),e.color&&o.jsxs(c,{fontSize:"md",children:["Color: ",e.color.name]})]}),o.jsxs(G,{gap:0,children:[o.jsxs(c,{fontWeight:600,fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs.",e.discountedPrice>0?e.discountedPrice:e.totalPrice]}),o.jsxs(c,{alignSelf:"end",fontSize:{base:"12px",md:"14px"},children:["X ",e.quantity]})]})]},e.id)},e.id))})}),o.jsxs(P,{as:h,gap:2,flexDir:"column",colSpan:1,w:{md:"70%"},justifySelf:{md:"end"},children:[o.jsx("form",{onSubmit:F(O),children:o.jsxs(m,{py:2,align:"start",children:[o.jsx(V,{name:"promo_code",control:W,placeholder:"Enter Promo Code",errorMessage:q}),o.jsx(y,{type:"submit",isLoading:g.isPending,fontSize:{sm:"14px",md:"16px"},fontWeight:400,borderRadius:"2px",children:"Apply"})]})}),p&&(p==null?void 0:p.map(e=>o.jsxs(m,{justify:"space-between",py:2,children:[o.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:e.product.name}),o.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs."," ",e.discountedPrice>0?e.discountedPrice*e.quantity:e.totalPrice*e.quantity]})]},e.id))),o.jsxs(m,{justify:"space-between",py:2,children:[o.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Discount"}),o.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["- Rs. ",S]})]}),o.jsx(j,{w:"full",h:"1px",bg:"#939292"}),o.jsxs(m,{justify:"space-between",py:2,children:[o.jsx(c,{fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Subtotal"}),o.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs. ",w]})]}),o.jsx(y,{onClick:T,colorScheme:"primary",borderRadius:"2px",mt:4,children:"Checkout"})]})]})};export{oe as default};
