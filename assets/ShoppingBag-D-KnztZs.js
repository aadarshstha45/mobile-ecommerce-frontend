import{e as B,r as i,d as N,Y as k,j as e,F as h,B as j,I as A,am as M,T as c,S as G,ab as m,a as y,aj as v}from"./index-lyI6rhgr.js";import{a as J}from"./index-B3g0AdAT.js";import{a as V}from"./TextInput-CsWWPEC7.js";import{u as H}from"./orderStore-LTrD6kGc.js";import{S as Q,G as P}from"./chunk-ZPFGWTBB-BNQdny1P.js";import"./x-Nu1_7VwP.js";import"./chunk-H46NUPBZ-DIaA_ULh.js";const eo=({stepProps:b})=>{const z=B(),[l,_]=i.useState([]),[x]=N("(max-width: 469px)"),[p,I]=i.useState(0),[a,C]=i.useState(0),[w,f]=i.useState(0),[S,u]=i.useState(0),[D,E]=i.useState(""),[q,R]=i.useState(""),{control:W,handleSubmit:F}=k({defaultValues:{total_amount:"",promo_code:""}}),g=J(),{setStepData:L}=H();i.useEffect(()=>{const o=sessionStorage.getItem("cartItems");if(o){const r=JSON.parse(o);_(r);let s=0;r.forEach(t=>{s+=t.totalPrice*t.quantity});let n=0;r.forEach(t=>{n+=t.discountedPrice>0?t.discountedPrice*t.quantity:t.totalPrice*t.quantity}),I(s),C(n),f(n)}},[z.pathname,sessionStorage.getItem("cartItems")]);const O=async o=>{try{const r=await g.mutateAsync({...o,total_amount:a>0?a:p});if(r.data.valid){E(o.promo_code);const s=r.data.type,n=parseFloat(r.data.rate),t=parseFloat(r.data.max_discount);if(s==="percentage"){const d=a>0?a*n/100:p*n/100;if(d>=t){u(t),f(a>0?a-t:p-t);return}else{u(d),f(a>0?a-d:p-d);return}}else{u(n),f(a>0?a-n:p-S);return}}else R(r.data.error),u(0)}catch(r){console.error("Error applying promo code:",r),u(0)}},T=()=>{const o=sessionStorage.getItem("cartItems");if(o&&o.length>0){const r=JSON.parse(o);L({order_items:r.map(s=>{var n,t,d;return{cart_id:s==null?void 0:s.id,product_id:(n=s==null?void 0:s.product)==null?void 0:n.id,quantity:s==null?void 0:s.quantity,discount:s.discountedPrice?s.totalPrice-s.discountedPrice:0,price:s.size?s.size.price:s.product.price,size_id:(t=s==null?void 0:s.size)==null?void 0:t.id,color_id:(d=s==null?void 0:s.color)==null?void 0:d.id,total:s.discountedPrice??s.totalPrice}}),promo_discount:S,total_amount:a??p,promo_code:D??null}),b.nextStep()}else v.error("No items in the cart")};return e.jsxs(Q,{columns:{base:1,md:2},gap:6,alignItems:"start",children:[e.jsx(P,{colSpan:1,children:e.jsx(h,{flexDir:"column",gap:4,children:l&&l.map(o=>e.jsx(j,{borderBottom:"1px solid #939292",py:6,children:e.jsxs(h,{gap:8,flexDir:x?"column":"row",align:x?"start":"center",children:[e.jsx(A,{src:o.product.image??M,alt:o.product.name,objectFit:o.product.image?"cover":"contain",objectPosition:"center",w:{base:"100px",md:"150px"},aspectRatio:1/1}),e.jsxs(h,{flexDir:"column",gap:3,minW:x?"100%":"50%",w:x?"100%":"50%",children:[e.jsx(c,{fontWeight:600,noOfLines:2,fontSize:"md",children:o.product.name}),o.size&&e.jsxs(c,{fontSize:"md",children:["Size: ",o.size.name]}),o.color&&e.jsxs(c,{fontSize:"md",children:["Color: ",o.color.name]})]}),e.jsxs(G,{gap:0,children:[e.jsxs(c,{fontWeight:600,fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs.",o.discountedPrice>0?o.discountedPrice:o.totalPrice]}),e.jsxs(c,{alignSelf:"end",fontSize:{base:"12px",md:"14px"},children:["X ",o.quantity]})]})]},o.id)},o.id))})}),e.jsxs(P,{as:h,gap:2,flexDir:"column",colSpan:1,w:{md:"70%"},justifySelf:{md:"end"},children:[e.jsx("form",{onSubmit:F(O),children:e.jsxs(m,{py:2,align:"start",children:[e.jsx(V,{name:"promo_code",control:W,placeholder:"Enter Promo Code",errorMessage:q}),e.jsx(y,{type:"submit",isLoading:g.isPending,fontSize:{sm:"14px",md:"16px"},fontWeight:400,borderRadius:"2px",children:"Apply"})]})}),l&&(l==null?void 0:l.map(o=>e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:o.product.name}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs."," ",o.discountedPrice>0?o.discountedPrice*o.quantity:o.totalPrice*o.quantity]})]},o.id))),e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Discount"}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["- Rs. ",S]})]}),e.jsx(j,{w:"full",h:"1px",bg:"#939292"}),e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Subtotal"}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs. ",w]})]}),e.jsx(y,{onClick:T,colorScheme:"primary",borderRadius:"2px",mt:4,children:"Checkout"})]})]})};export{eo as default};
