import{c as B,r as i,b as N,V as k,j as e,F as h,B as j,I as A,aq as M,T as c,S as G,ag as m,a2 as y,ao as V}from"./index-Cjcb6Cy6.js";import{a as v}from"./index-Dohw7nYc.js";import{a as J}from"./TextInput-DTYyJr8v.js";import{u as H}from"./orderStore-DXHlw8Ua.js";import{S as Q,G as P}from"./chunk-ZPFGWTBB-yUb5jdlR.js";import"./x-C1A-ezDW.js";import"./chunk-H46NUPBZ-Bq3O0Iqe.js";const eo=({stepProps:b})=>{const z=B(),[p,_]=i.useState([]),[x]=N("(max-width: 469px)"),[d,I]=i.useState(0),[r,C]=i.useState(0),[w,f]=i.useState(0),[S,u]=i.useState(0),[D,q]=i.useState(""),[E,R]=i.useState(""),{control:W,handleSubmit:F}=k({defaultValues:{total_amount:"",promo_code:""}}),g=v(),{setStepData:L}=H();i.useEffect(()=>{const o=sessionStorage.getItem("cartItems");if(o){const a=JSON.parse(o);_(a);let s=0;a.forEach(t=>{s+=t.totalPrice*t.quantity});let n=0;a.forEach(t=>{n+=t.discountedPrice>0?t.discountedPrice*t.quantity:t.totalPrice*t.quantity}),I(s),C(n),f(n)}},[z.pathname,sessionStorage.getItem("cartItems")]);const O=async o=>{console.log({discountedPrice:r,total_amount:r>0?r:d});try{const a=await g.mutateAsync({...o,total_amount:r>0?r:d});if(a.data.valid){q(o.promo_code);const s=a.data.type,n=parseFloat(a.data.rate),t=parseFloat(a.data.max_discount);if(s==="percentage"){const l=r>0?r*n/100:d*n/100;if(l>=t){u(t),f(r>0?r-t:d-t);return}else{u(l),f(r>0?r-l:d-l);return}}else{u(n),f(r>0?r-n:d-S);return}}else R(a.data.error),u(0)}catch(a){console.error("Error applying promo code:",a),u(0)}},T=()=>{const o=sessionStorage.getItem("cartItems");if(o&&o.length>0){const a=JSON.parse(o);L({order_items:a.map(s=>{var n,t,l;return{cart_id:s==null?void 0:s.id,product_id:(n=s==null?void 0:s.product)==null?void 0:n.id,quantity:s==null?void 0:s.quantity,discount:s.discountedPrice?s.totalPrice-s.discountedPrice:0,price:s.size?s.size.price:s.product.price,size_id:(t=s==null?void 0:s.size)==null?void 0:t.id,color_id:(l=s==null?void 0:s.color)==null?void 0:l.id,total:s.discountedPrice??s.totalPrice}}),promo_discount:S,total_amount:r??d,promo_code:D??null}),b.nextStep()}else V.error("No items in the cart")};return e.jsxs(Q,{columns:{base:1,md:2},gap:6,alignItems:"start",children:[e.jsx(P,{colSpan:1,children:e.jsx(h,{flexDir:"column",gap:4,children:p&&p.map(o=>e.jsx(j,{borderBottom:"1px solid #939292",py:6,children:e.jsxs(h,{gap:8,flexDir:x?"column":"row",align:x?"start":"center",children:[e.jsx(A,{src:o.product.image??M,alt:o.product.name,objectFit:o.product.image?"cover":"contain",objectPosition:"center",w:{base:"100px",md:"150px"},aspectRatio:1/1}),e.jsxs(h,{flexDir:"column",gap:3,minW:x?"100%":"50%",w:x?"100%":"50%",children:[e.jsx(c,{fontWeight:600,noOfLines:2,fontSize:"md",children:o.product.name}),o.size&&e.jsxs(c,{fontSize:"md",children:["Size: ",o.size.name]}),o.color&&e.jsxs(c,{fontSize:"md",children:["Color: ",o.color.name]})]}),e.jsxs(G,{gap:0,children:[e.jsxs(c,{fontWeight:600,fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs.",o.discountedPrice>0?o.discountedPrice:o.totalPrice]}),e.jsxs(c,{alignSelf:"end",fontSize:{base:"12px",md:"14px"},children:["X ",o.quantity]})]})]},o.id)},o.id))})}),e.jsxs(P,{as:h,gap:2,flexDir:"column",colSpan:1,w:{md:"70%"},justifySelf:{md:"end"},children:[e.jsx("form",{onSubmit:F(O),children:e.jsxs(m,{py:2,align:"start",children:[e.jsx(J,{name:"promo_code",control:W,placeholder:"Enter Promo Code",errorMessage:E}),e.jsx(y,{type:"submit",isLoading:g.isPending,fontSize:{sm:"14px",md:"16px"},fontWeight:400,borderRadius:"2px",children:"Apply"})]})}),p&&(p==null?void 0:p.map(o=>e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:o.product.name}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs."," ",o.discountedPrice>0?o.discountedPrice*o.quantity:o.totalPrice*o.quantity]})]},o.id))),e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Discount"}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["- Rs. ",S]})]}),e.jsx(j,{w:"full",h:"1px",bg:"#939292"}),e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Subtotal"}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs. ",w]})]}),e.jsx(y,{onClick:T,colorScheme:"primary",borderRadius:"2px",mt:4,children:"Checkout"})]})]})};export{eo as default};
