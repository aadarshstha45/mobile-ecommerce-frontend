import{c as A,r as i,b as B,V as N,j as s,F as h,B as j,I as k,aC as M,T as c,S as G,as as m,a2 as y,aA as V}from"./index-CpGNqzAf.js";import{a as v}from"./index-C5871K7N.js";import{T as J}from"./TextInput-BYGBnmSL.js";import{u as H}from"./orderStore-BI_ziCtY.js";import{S as Q,G as P}from"./chunk-ZPFGWTBB-AI4KMFNg.js";import"./x-OvysVRsN.js";import"./chunk-H46NUPBZ-CJujcYIV.js";const so=({stepProps:b})=>{const z=A(),[p,_]=i.useState([]),[x]=B("(max-width: 469px)"),[d,I]=i.useState(0),[r,C]=i.useState(0),[w,f]=i.useState(0),[S,u]=i.useState(0),[D,E]=i.useState(""),[q,R]=i.useState(""),{control:T,handleSubmit:W}=N({defaultValues:{total_amount:"",promo_code:""}}),g=v(),{setStepData:F}=H();i.useEffect(()=>{const o=sessionStorage.getItem("cartItems");if(o){const a=JSON.parse(o);_(a);let e=0;a.forEach(t=>{e+=t.totalPrice*t.quantity});let n=0;a.forEach(t=>{n+=t.discountedPrice>0?t.discountedPrice*t.quantity:t.totalPrice*t.quantity}),I(e),C(n),f(n)}},[z.pathname,sessionStorage.getItem("cartItems")]);const L=async o=>{console.log({discountedPrice:r,total_amount:r>0?r:d});try{const a=await g.mutateAsync({...o,total_amount:r>0?r:d});if(a.data.valid){E(o.promo_code);const e=a.data.type,n=parseFloat(a.data.rate),t=parseFloat(a.data.max_discount);if(e==="percentage"){const l=r>0?r*n/100:d*n/100;if(l>=t){u(t),f(r>0?r-t:d-t);return}else{u(l),f(r>0?r-l:d-l);return}}else{u(n),f(r>0?r-n:d-S);return}}else R(a.data.error),u(0)}catch(a){console.error("Error applying promo code:",a),u(0)}},O=()=>{const o=sessionStorage.getItem("cartItems");if(o&&o.length>0){const a=JSON.parse(o);F({order_items:a.map(e=>{var n,t,l;return{cart_id:e==null?void 0:e.id,product_id:(n=e==null?void 0:e.product)==null?void 0:n.id,quantity:e==null?void 0:e.quantity,discount:e.discountedPrice?e.totalPrice-e.discountedPrice:0,price:e.size?e.size.price:e.product.price,size_id:(t=e==null?void 0:e.size)==null?void 0:t.id,color_id:(l=e==null?void 0:e.color)==null?void 0:l.id,total:e.discountedPrice??e.totalPrice}}),promo_discount:S,total_amount:r??d,promo_code:D??null}),b.nextStep()}else V.error("No items in the cart")};return s.jsxs(Q,{columns:{base:1,md:2},gap:6,alignItems:"start",children:[s.jsx(P,{colSpan:1,children:s.jsx(h,{flexDir:"column",gap:4,children:p&&p.map(o=>s.jsx(j,{borderBottom:"1px solid #939292",py:6,children:s.jsxs(h,{gap:8,flexDir:x?"column":"row",align:x?"start":"center",children:[s.jsx(k,{src:o.product.image??M,alt:o.product.name,objectFit:o.product.image?"cover":"contain",objectPosition:"center",w:{base:"100px",md:"150px"},aspectRatio:1/1}),s.jsxs(h,{flexDir:"column",gap:3,minW:x?"100%":"50%",w:x?"100%":"50%",children:[s.jsx(c,{fontWeight:600,noOfLines:2,fontSize:"md",children:o.product.name}),o.size&&s.jsxs(c,{fontSize:"md",children:["Size: ",o.size.name]}),o.color&&s.jsxs(c,{fontSize:"md",children:["Color: ",o.color.name]})]}),s.jsxs(G,{gap:0,children:[s.jsxs(c,{fontWeight:600,fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs.",o.discountedPrice>0?o.discountedPrice:o.totalPrice]}),s.jsxs(c,{alignSelf:"end",fontSize:{base:"12px",md:"14px"},children:["X ",o.quantity]})]})]},o.id)},o.id))})}),s.jsxs(P,{as:h,gap:2,flexDir:"column",colSpan:1,w:{md:"70%"},justifySelf:{md:"end"},children:[s.jsx("form",{onSubmit:W(L),children:s.jsxs(m,{py:2,align:"start",children:[s.jsx(J,{name:"promo_code",control:T,placeholder:"Enter Promo Code",errorMessage:q}),s.jsx(y,{type:"submit",isLoading:g.isPending,fontSize:{sm:"14px",md:"16px"},fontWeight:400,borderRadius:"2px",children:"Apply"})]})}),p&&(p==null?void 0:p.map(o=>s.jsxs(m,{justify:"space-between",py:2,children:[s.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:o.product.name}),s.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs."," ",o.discountedPrice>0?o.discountedPrice*o.quantity:o.totalPrice*o.quantity]})]},o.id))),s.jsxs(m,{justify:"space-between",py:2,children:[s.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Discount"}),s.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["- Rs. ",S]})]}),s.jsx(j,{w:"full",h:"1px",bg:"#939292"}),s.jsxs(m,{justify:"space-between",py:2,children:[s.jsx(c,{fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Subtotal"}),s.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs. ",w]})]}),s.jsx(y,{onClick:O,colorScheme:"primary",borderRadius:"2px",mt:4,children:"Checkout"})]})]})};export{so as default};
