import{c as B,r as l,b as N,W as k,b6 as A,j as e,F as h,B as y,I as G,aI as M,T as c,S as v,at as m,a3 as P,aG as J}from"./index-BISsgrs9.js";import{a as V}from"./index-DJtiY0PX.js";import{T as H}from"./TextInput-BhA_o2nr.js";import{S as Q,G as b}from"./chunk-ZPFGWTBB-DjIHd1pL.js";import"./index.esm-jS8sanS8.js";import"./chunk-H46NUPBZ-Dd1bnTT1.js";const oo=({stepProps:z})=>{const _=B(),[p,I]=l.useState([]),[x]=N("(max-width: 469px)"),[d,C]=l.useState(0),[r,S]=l.useState(0),[w,f]=l.useState(0),[g,u]=l.useState(0),[D,E]=l.useState(""),[q,R]=l.useState(""),{control:W,handleSubmit:T}=k({defaultValues:{total_amount:"",promo_code:""}}),j=V(),{setStepData:F}=A();l.useEffect(()=>{const o=sessionStorage.getItem("cartItems");if(o){const a=JSON.parse(o);I(a);let s=0;a.forEach(t=>{s+=t.totalPrice*t.quantity});let n=0;a.forEach(t=>{n+=t.discountedPrice>0?t.discountedPrice*t.quantity:t.totalPrice*t.quantity}),C(s),S(n),f(n)}},[_.pathname,sessionStorage.getItem("cartItems")]);const L=async o=>{try{const a=await j.mutateAsync({...o,total_amount:r>0?r:d});if(a.data.valid){E(o.promo_code);const s=a.data.type,n=parseFloat(a.data.rate),t=parseFloat(a.data.max_discount);if(s==="percentage"){const i=r>0?r*n/100:d*n/100;if(i>=t){u(t),S(r>0?r-t:d-t),f(r>0?r-t:d-t);return}else{u(i),S(r>0?r-i:d-i),f(r>0?r-i:d-i);return}}else{u(n),f(r>0?r-n:d-g);return}}else R(a.data.error),u(0)}catch(a){console.error("Error applying promo code:",a),u(0)}},O=()=>{const o=sessionStorage.getItem("cartItems");if(o&&o.length>0){const a=JSON.parse(o);F({order_items:a.map(s=>{var n,t,i;return{cart_id:s==null?void 0:s.id,product_id:(n=s==null?void 0:s.product)==null?void 0:n.id,quantity:s==null?void 0:s.quantity,discount:s.discountedPrice?s.totalPrice-s.discountedPrice:0,price:s.size?s.size.price:s.product.price,size_id:(t=s==null?void 0:s.size)==null?void 0:t.id,color_id:(i=s==null?void 0:s.color)==null?void 0:i.id,total:s.discountedPrice??s.totalPrice}}),promo_discount:g,total_amount:r??d,promo_code:D??null}),z.nextStep()}else J.error("No items in the cart")};return e.jsxs(Q,{columns:{base:1,md:2},gap:6,alignItems:"start",children:[e.jsx(b,{colSpan:1,children:e.jsx(h,{flexDir:"column",gap:4,children:p&&p.map(o=>e.jsx(y,{borderBottom:"1px solid #939292",py:6,children:e.jsxs(h,{gap:8,flexDir:x?"column":"row",align:x?"start":"center",children:[e.jsx(G,{src:o.product.image??M,alt:o.product.name,objectFit:o.product.image?"cover":"contain",objectPosition:"center",w:{base:"100px",md:"150px"},aspectRatio:1/1}),e.jsxs(h,{flexDir:"column",gap:3,minW:x?"100%":"50%",w:x?"100%":"50%",children:[e.jsx(c,{fontWeight:600,noOfLines:2,fontSize:"md",children:o.product.name}),o.size&&e.jsxs(c,{fontSize:"md",children:["Size: ",o.size.name]}),o.color&&e.jsxs(c,{fontSize:"md",children:["Color: ",o.color.name]})]}),e.jsxs(v,{gap:0,children:[e.jsxs(c,{fontWeight:600,fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs.",o.discountedPrice>0?o.discountedPrice:o.totalPrice]}),e.jsxs(c,{alignSelf:"end",fontSize:{base:"12px",md:"14px"},children:["X ",o.quantity]})]})]},o.id)},o.id))})}),e.jsxs(b,{as:h,gap:2,flexDir:"column",colSpan:1,w:{md:"70%"},justifySelf:{md:"end"},children:[e.jsx("form",{onSubmit:T(L),children:e.jsxs(m,{py:2,align:"start",children:[e.jsx(H,{name:"promo_code",control:W,label:"Promo Code",placeholder:"Enter Promo Code",errorMessage:q}),e.jsx(P,{type:"submit",mt:6,isLoading:j.isPending,fontSize:{sm:"14px",md:"16px"},fontWeight:400,borderRadius:"2px",children:"Apply"})]})}),p&&(p==null?void 0:p.map(o=>e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:o.product.name}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs."," ",o.discountedPrice>0?o.discountedPrice*o.quantity:o.totalPrice*o.quantity]})]},o.id))),e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{noOfLines:2,fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Discount"}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["- Rs. ",g]})]}),e.jsx(y,{w:"full",h:"1px",bg:"#939292"}),e.jsxs(m,{justify:"space-between",py:2,children:[e.jsx(c,{fontWeight:500,fontSize:{base:"14px",md:"16px",xl:"18px"},children:"Subtotal"}),e.jsxs(c,{textColor:"primary.500",fontSize:{base:"12px",md:"14px",xl:"16px"},children:["Rs. ",w]})]}),e.jsx(P,{onClick:O,colorScheme:"primary",borderRadius:"2px",mt:4,children:"Checkout"})]})]})};export{oo as default};
